<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="generator" content="AsciiDoc 8.6.9, bootstrap backend 4.0.0">
    <title>Creating applications with QtQuick and OCaml</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Dmitrii Kosarev aka Kakadu">
    <!-- AsciiDoc Bootstrap styles -->
    <link rel="stylesheet" type="text/css" href="./stylesheets/asciidoc-bootstrap.readable.min.css">
    <!-- source highlighter -->
    <link rel="stylesheet" type="text/css" href="./stylesheets/pygments.monokai.css">
    <!-- Back to top (jquery plugin) -->
    <link rel="stylesheet" type="text/css" href="./stylesheets/ui.totop.css">

    <!--[if (lt IE 9) & (!IEMobile)]>
        <script src="./javascripts/html5shiv.min.js"></script>
        <script src="./javascripts/respond.min.js"></script>
    <![endif]-->

  </head>
  <body>



  <div class="container">

    <div class="row">

        <div class="col-md-12" role="main">
<div class="exampleblock col-md-4">
<div class="content">
<div class="panel panel-primary">
<div class="panel-heading"><h3 class="panel-title">Table of Contents</h3></div>
<div class="panel-body">
<div class="ulist"><ul>
<li>
<p>
<a href="#about">About</a>
</p>
</li>
<li>
<p>
<a href="#hello_world">Hello world!</a>
</p>
</li>
<li>
<p>
<a href="#metamodel">Qt objects' metamodel</a>
</p>
</li>
<li>
<p>
<a href="#properties">Adding properties</a>
</p>
</li>
<li>
<p>
<a href="#signals">Adding signals</a>
</p>
</li>
<li>
<p>
<a href="#types">Supported types</a>
</p>
</li>
<li>
<p>
<a href="#building">Build system</a>
</p>
</li>
<li>
<p>
<a href="#conclusion">Conclusion</a>
</p>
</li>
<li>
<p>
<a href="#qt5">P.S. Installing Qt5</a>
</p>
</li>
</ul></div>
</div>
</div>
</div></div>
<section>
    <div class="clearfix">
      <div class="page-header" id="about">
        <h1>About</h1>
      </div>
<div class="paragraph"><p>In this tutorial we will see how to create simple QtQuick applications and how they will communicate with OCaml. QtQuick code will be very short because this tutorial is about using OCaml and QtQuick together. To get more information about programming in QtQuick you can visit 
<a href="https://qt-project.org/doc/qt-5/qtquick-index.html">official help</a> or 
<a href="http://qmlbook.org/">QML book</a>.</p></div>
<div class="paragraph"><p>Demos described below and sources of this tutorial can be found in Github <a href="http://github.com/Kakadu/lablqt/tree/gh-pages/demos/0.3">repository</a>.</p></div>
    </div>
</section>
<section>
    <div class="clearfix">
      <div class="page-header" id="changelog">
        <h1>Changelog</h1>
      </div>
<div class="paragraph"><p>This tutorial is the second one about OCaml and QtQuick. You can get old one 
<a href="tutorial.html">here</a>.
In <code>lablqt</code> starting from version <code>0.3</code> external JSON file for specifying API is deprecated, PPX extension is required. That&#8217;s why, <code>lablqt 0.3</code> requires OCaml 4.02 or newer.</p></div>
    </div>
</section>
<section>
    <div class="clearfix">
      <div class="page-header" id="hello_world">
        <h1>"Hello world!" in QtQuick</h1>
      </div>
<div class="paragraph"><p>In this chapter a very simple QtQuick application is described. It interacts with OCaml only one-way: by calling handler on mouse click.</p></div>
<div class="paragraph"><p>In piece of code below application&#8217;s window is created, with colored area at the top and some text centered in it. Some properties of application&#8217;s window are set. Position of inner rectangle is described using 
<a href="http://qmlbook.org/ch04/index.html#positioning-elements">anchors</a>.</p></div>
<div class="listingblock">
<div class="content"><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> QtQuick <span style="color: #0000DD; font-weight: bold">2.0</span>
<span style="color: #008800; font-weight: bold">import</span> QtQuick.Controls <span style="color: #0000DD; font-weight: bold">1.0</span>

ApplicationWindow {
    <span style="color: #008800; font-weight: bold">title:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;Hello world!&quot;</span>
    <span style="color: #008800; font-weight: bold">color:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;#FFFFDF&quot;</span>
    <span style="color: #008800; font-weight: bold">width:</span> <span style="color: #0000DD; font-weight: bold">400</span>
    <span style="color: #008800; font-weight: bold">height:</span> <span style="color: #0000DD; font-weight: bold">450</span>

    Rectangle {
        <span style="color: #008800; font-weight: bold">color:</span>  <span style="color: #dd2200; background-color: #fff0f0">&quot;lightgreen&quot;</span>
        <span style="color: #008800; font-weight: bold">height:</span> <span style="color: #0000DD; font-weight: bold">150</span>
        anchors {
            <span style="color: #008800; font-weight: bold">left:</span>  parent.left
            <span style="color: #008800; font-weight: bold">right:</span> parent.right
            <span style="color: #008800; font-weight: bold">top:</span>   parent.top
        }
        Text {
            <span style="color: #008800; font-weight: bold">text:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;Click me!&quot;</span>
            <span style="color: #008800; font-weight: bold">anchors.centerIn:</span> parent
        }
    }
}
</pre></div>
</td></tr></table></div></div>
<div class="admonition note">
<div class="icon">
<img src="./images/icons/note.png" alt="Note">
</div>
<div class="content">QtQuick and QML are very similar concepts and can replace each other. In Qt Modeling Language (QML) we describe the user interface and store it in files with <code>qml</code> extension. QtQuick is a collection of classes from which GUI can be built.</div>
</div>
<div class="paragraph"><p>This QML file is already a valid application. It can be executed without any compilation by command <code>qmlscene Root.qml</code>. Running the application should look like as on this picture:</p></div>
<div class="imageblock">
<div class="content">
<img class="img-responsive" src="images/tutorial2/img1.png" alt="images/tutorial2/img1.png">
</div>
</div>
<div class="paragraph"><p>The normal way to interact between QtQuick and C++ is by exposing some objects into QtQuick engine. <code>Lablqt</code> has specific API for exposing objects and allows to declare them in OCaml (instead on C++) by using PPX extension. Build system will compile all into final executable. Let&#8217;s describe class <code>controller</code> in <code>controller.ml</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">open</span> <span style="color: #bb0066; font-weight: bold">QmlContext</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #008800; font-weight: bold">virtual</span> controller = <span style="color: #008800; font-weight: bold">object</span>(self)
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> onMouseClicked: <span style="color: #888888; font-weight: bold">unit</span> -&gt; <span style="color: #888888; font-weight: bold">unit</span>[@@qtmeth]
<span style="color: #008800; font-weight: bold">end</span>[@@qtclass]
</pre></div></div></div>
<div class="paragraph"><p>The module <code>QmlContext</code> can be found in ocamlfind package named <code>lablqml</code>. This package and PPX extension named <code>ppx_qt</code> are located in OPAM&#8217;s package <code>lablqt</code> with version <code>0.3</code>. To apply syntax extension on this file you need to execute the following command:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>ocamlopt -I `ocamlfind query lablqml` -c -dsource -ppx "ppx_qt -destdir . -ext cpp" controller.ml</pre>
</div></div>
<div class="paragraph"><p>In <code>controller.ml</code> you can see the class <code>controller</code> with attribute <code>qtclass</code> and its method <code>onMouseClicked</code> with attribute <code>qtmeth</code>. Without this attributes the class and its method will not be available in QtQuick.</p></div>
<div class="paragraph"><p>After preprocessing the source file a virtual class called <code>controller</code> will be generated. Let&#8217;s implement a virtual method <code>onMouseClicked</code> in <code>program.ml</code></p></div>
<div class="listingblock">
<div class="content"><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">open</span> <span style="color: #bb0066; font-weight: bold">QmlContext</span>

<span style="color: #888888">(* Helper function to expose the object &#39;obj&#39; into QtQuick engine.</span>
<span style="color: #888888"> * Argument &#39;name&#39; means the name for this object in QtQuick</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * It is not interesting function. You can simply copy and paste it.</span>
<span style="color: #888888"> *)</span>
<span style="color: #008800; font-weight: bold">let</span> expose ~name obj =
  <span style="color: #888888">(* &#39;obj#handler&#39; is raw C++ pointer to object. *)</span>
  set_context_property ~ctx:(get_view_exn ~name:<span style="color: #dd2200; background-color: #fff0f0">&quot;rootContext&quot;</span>) ~name obj#handler

<span style="color: #888888">(* This function is called once before constructing window. It exposes some</span>
<span style="color: #888888"> * objects from OCaml to QtQuick engine</span>
<span style="color: #888888"> *)</span>
<span style="color: #008800; font-weight: bold">let</span> init: <span style="color: #888888; font-weight: bold">unit</span> -&gt; <span style="color: #888888; font-weight: bold">unit</span> = <span style="color: #008800; font-weight: bold">fun</span> <span style="color: #003388">()</span> -&gt;
  <span style="color: #008800; font-weight: bold">let</span> controller = <span style="color: #008800; font-weight: bold">object</span>(self)
    <span style="color: #008800; font-weight: bold">inherit</span> <span style="color: #bb0066; font-weight: bold">Controller</span>.controller (<span style="color: #bb0066; font-weight: bold">Controller</span>.create_controller <span style="color: #003388">()</span>) <span style="color: #008800; font-weight: bold">as</span> super
    <span style="color: #888888">(* &#39;onMouseClicked&#39; is the method marked with [@@qtmeth] attribute in &#39;controller.ml&#39;</span>
<span style="color: #888888">     * We need to implement it. *)</span>
    <span style="color: #008800; font-weight: bold">method</span> onMouseClicked <span style="color: #003388">()</span> =
      print_endline <span style="color: #dd2200; background-color: #fff0f0">&quot;OCaml says: Mouse Clicked!&quot;</span>
  <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">in</span>
  <span style="color: #888888">(* Once object is created we make it available in QtQuick engine *)</span>
  expose ~name:<span style="color: #dd2200; background-color: #fff0f0">&quot;controller&quot;</span> controller

<span style="color: #008800; font-weight: bold">let</span> <span style="color: #003388">()</span> =
  <span style="color: #008800; font-weight: bold">let</span> qmlfile = <span style="color: #dd2200; background-color: #fff0f0">&quot;Root.qml&quot;</span> <span style="color: #008800; font-weight: bold">in</span>
  <span style="color: #888888">(* We start application and pass initialization function and main QML file *)</span>
  run_with_QQmlApplicationEngine <span style="color: #bb0066; font-weight: bold">Sys</span>.argv init qmlfile
</pre></div>
</td></tr></table></div></div>
<div class="paragraph"><p>In the snippet of code above, the path to the QML file is relative. QML files can be embedded into final executable using <a href="http://qt-project.org/doc/qt-5.0/qtcore/resources.html">Qt Resource System</a>.</p></div>
<div class="paragraph"><p>The QML file doesn&#8217;t know anything about the exposed object yet. So, let&#8217;s create some area which will receive mouse events and call OCaml if it is clicked.</p></div>
<div class="listingblock">
<div class="content"><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> QtQuick <span style="color: #0000DD; font-weight: bold">2.0</span>
<span style="color: #008800; font-weight: bold">import</span> QtQuick.Controls <span style="color: #0000DD; font-weight: bold">1.0</span>

ApplicationWindow {
    <span style="color: #008800; font-weight: bold">title:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;Hello world!&quot;</span>
    <span style="color: #008800; font-weight: bold">color:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;#FFFFDF&quot;</span>
    <span style="color: #008800; font-weight: bold">width:</span> <span style="color: #0000DD; font-weight: bold">400</span>
    <span style="color: #008800; font-weight: bold">height:</span> <span style="color: #0000DD; font-weight: bold">450</span>

    Rectangle {
        <span style="color: #008800; font-weight: bold">color:</span>  <span style="color: #dd2200; background-color: #fff0f0">&quot;lightgreen&quot;</span>
        <span style="color: #008800; font-weight: bold">height:</span> <span style="color: #0000DD; font-weight: bold">150</span>
        anchors {
            <span style="color: #008800; font-weight: bold">left:</span>  parent.left
            <span style="color: #008800; font-weight: bold">right:</span> parent.right
            <span style="color: #008800; font-weight: bold">top:</span>   parent.top
        }
        Text {
            <span style="color: #008800; font-weight: bold">text:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;Click me!&quot;</span>
            <span style="color: #008800; font-weight: bold">anchors.centerIn:</span> parent
        }
        MouseArea {
            <span style="color: #008800; font-weight: bold">anchors.fill:</span> parent
            <span style="color: #008800; font-weight: bold">onClicked:</span> {
              <span style="color: #888888">// call OCaml there</span>
              controller.onMouseClicked()
            }
        }
    }
}
</pre></div>
</td></tr></table></div></div>
<div class="admonition note">
<div class="icon">
<img src="./images/icons/note.png" alt="Note">
</div>
<div class="content">
<div class="title">Where is the entry point?</div>Our applications can start either from OCaml and C++. Example above starts up from OCaml. See <a href="http:github.com/Kakadu/lablqt/tree/gh-pages/demos/0.2/demo3">demos</a> from previous tutorial to get examples of startup from C++.</div>
</div>
<div class="paragraph"><p>Full code of first demo is available on <a href="https://github.com/Kakadu/lablqt/tree/gh-pages/demos/0.3/demo1">github</a>.</p></div>
    </div>
</section>
<section>
    <div class="clearfix">
      <div class="page-header" id="properties">
        <h1>Qt object&#8217;s metamodel</h1>
      </div>
<div class="paragraph"><p>Qt classes based on <code>QObject</code> can have <small>properties</small>, <small>signals</small>, <small>slots</small> and methods <small>invokable</small> from QtQuick. All information about this stuff is generated from C++ header files during compilation phase.</p></div>
<div class="paragraph"><p>For example, our method <code>onMouseClicked</code> declared above is invokable, that&#8217;s why we can use it from QML. If it was not, we would get the following type error:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Property 'onMouseClicked' of object controller(0x153cd00) is not a function</pre>
</div></div>
<div class="paragraph"><p>Properties always have name, type and methods that return its values. They can also have methods that set values. When a property changes it can send a <small>signal</small> with the updated value.</p></div>
<div class="paragraph"><p><small>Signals</small> usually are <small>connected</small> with <small>slots</small>. See this C++ code, for example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">auto</span> listener = <span style="color: #008800; font-weight: bold">new</span> PortListener();
<span style="color: #008800; font-weight: bold">auto</span> parser = <span style="color: #008800; font-weight: bold">new</span> MessageParser();
connect(listener, SIGNAL(gotData(QByteArray)), parser, SLOT(onDataReceived(QByteArray)) );
</pre></div></div></div>
<div class="paragraph"><p>As you can see the relation between objects is established independently from them, i.e. object&#8217;s classes are independent: we don&#8217;t need to think about passing callbacks or creating some heavy-weight design patterns. That&#8217;s the Qt way of avoiding dependency injection.</p></div>
    </div>
</section>
<section>
    <div class="clearfix">
      <div class="page-header" id="properties">
        <h1>Adding properties</h1>
      </div>
<div class="paragraph"><p>Let&#8217;s extend the first demo by counting how many times we have clicked on the window. We will do it by declaring a property of type <code>int</code>. To do this we need to improve our class definition in <code>controller.ml</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">open</span> <span style="color: #bb0066; font-weight: bold">QmlContext</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #008800; font-weight: bold">virtual</span> controller = <span style="color: #008800; font-weight: bold">object</span>(self)
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> onMouseClicked: <span style="color: #888888; font-weight: bold">unit</span> -&gt; <span style="color: #888888; font-weight: bold">unit</span>[@@qtmeth]
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> clicksCount: <span style="color: #888888; font-weight: bold">int</span>[@@qtprop]
<span style="color: #008800; font-weight: bold">end</span>[@@qtclass]
</pre></div></div></div>
<div class="paragraph"><p>Let&#8217;s extend the object implementation by adding a click counter:</p></div>
<div class="listingblock">
<div class="content"><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">open</span> <span style="color: #bb0066; font-weight: bold">QmlContext</span>

<span style="color: #008800; font-weight: bold">let</span> expose ~name obj =
  set_context_property ~ctx:(get_view_exn ~name:<span style="color: #dd2200; background-color: #fff0f0">&quot;rootContext&quot;</span>) ~name obj#handler

<span style="color: #008800; font-weight: bold">let</span> init <span style="color: #003388">()</span> =
  <span style="color: #008800; font-weight: bold">let</span> controller = <span style="color: #008800; font-weight: bold">object</span>(self)
    <span style="color: #008800; font-weight: bold">inherit</span> <span style="color: #bb0066; font-weight: bold">Controller</span>.controller (<span style="color: #bb0066; font-weight: bold">Controller</span>.create_controller <span style="color: #003388">()</span>) <span style="color: #008800; font-weight: bold">as</span> super

    <span style="color: #008800; font-weight: bold">val</span> <span style="color: #008800; font-weight: bold">mutable</span> counter = <span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">method</span> getclicksCount <span style="color: #003388">()</span> = counter

    <span style="color: #008800; font-weight: bold">method</span> onMouseClicked <span style="color: #003388">()</span> =
      print_endline <span style="color: #dd2200; background-color: #fff0f0">&quot;OCaml says: Mouse Clicked!&quot;</span>;
      counter &lt;- counter+<span style="color: #0000DD; font-weight: bold">1</span>;
      self#emit_clicksCountChanged counter
  <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">in</span>

  expose ~name:<span style="color: #dd2200; background-color: #fff0f0">&quot;controller&quot;</span> controller

<span style="color: #008800; font-weight: bold">let</span> <span style="color: #003388">()</span> =
  run_with_QQmlApplicationEngine <span style="color: #bb0066; font-weight: bold">Sys</span>.argv init <span style="color: #dd2200; background-color: #fff0f0">&quot;Root.qml&quot;</span>
</pre></div>
</td></tr></table></div></div>
<div class="paragraph"><p>When the user hits the mouse button the counter is incremented and a signal with the updated counter value  is emitted by OCaml method <code>emit_$(PROPERTY_NAME)Changed</code>. If Qt properties don&#8217;t notify GUI about these changes old values will be used and no changes will be applied.</p></div>
<div class="paragraph"><p>How QtQuick will react to these changes will be defined in <code>Root.qml</code>. The new rectangle with text inside will show how many times user have clicked. In this demo QtQuick <a href="https://qt-project.org/doc/qt-5/qtquicklayouts-overview.html">layouts</a> are used to place rectangles vertically. Anchors are not used to implement it.</p></div>
<div class="listingblock">
<div class="content"><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> QtQuick <span style="color: #0000DD; font-weight: bold">2.0</span>
<span style="color: #008800; font-weight: bold">import</span> QtQuick.Controls <span style="color: #0000DD; font-weight: bold">1.0</span>
<span style="color: #008800; font-weight: bold">import</span> QtQuick.Layouts <span style="color: #0000DD; font-weight: bold">1.0</span>

ApplicationWindow {
    <span style="color: #008800; font-weight: bold">title:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;OCaml&amp;QtQuick demo 2&quot;</span>
    property string <span style="color: #008800; font-weight: bold">backgroundColor:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;#FFFFDF&quot;</span>

    <span style="color: #008800; font-weight: bold">color:</span> backgroundColor
    <span style="color: #008800; font-weight: bold">width:</span> <span style="color: #0000DD; font-weight: bold">400</span>
    <span style="color: #008800; font-weight: bold">height:</span> <span style="color: #0000DD; font-weight: bold">450</span>

    ColumnLayout {
      Rectangle {
        <span style="color: #008800; font-weight: bold">color:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;lightgreen&quot;</span>
        <span style="color: #008800; font-weight: bold">Layout.preferredHeight:</span> <span style="color: #0000DD; font-weight: bold">150</span>
        <span style="color: #008800; font-weight: bold">Layout.preferredWidth:</span> <span style="color: #0000DD; font-weight: bold">400</span>
        Text {
          <span style="color: #008800; font-weight: bold">text:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;Click me!&quot;</span>
          <span style="color: #008800; font-weight: bold">anchors.centerIn:</span> parent
        }
        MouseArea {
          <span style="color: #008800; font-weight: bold">anchors.fill:</span> parent
          <span style="color: #008800; font-weight: bold">onClicked:</span> controller.onMouseClicked()
        }
      }
      Rectangle {
        <span style="color: #008800; font-weight: bold">color:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;#ebf097&quot;</span>
        <span style="color: #008800; font-weight: bold">Layout.preferredHeight:</span> <span style="color: #0000DD; font-weight: bold">150</span>
        <span style="color: #008800; font-weight: bold">Layout.preferredWidth:</span>  <span style="color: #0000DD; font-weight: bold">400</span>
        Text{
          <span style="color: #008800; font-weight: bold">anchors.centerIn:</span> parent
          <span style="color: #008800; font-weight: bold">text:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;You have clicked &quot;</span> + controller.clicksCount + <span style="color: #dd2200; background-color: #fff0f0">&quot; times&quot;</span>
        }
      }
    }
}
</pre></div>
</td></tr></table></div></div>
<div class="paragraph"><p>Our property is used in line</p></div>
<div class="listingblock">
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">text:</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;You have clicked &quot;</span> + controller.clicksCount + <span style="color: #dd2200; background-color: #fff0f0">&quot; times&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>At the right of the colon character should be a valid ECMAScript expression which is evaluted into a property value at runtime. It can be multiline, call some functions and methods and use many properties inside. When one of properties used inside changes the whole expression is reevaluated and the <code>text</code> property gets updated with a new value.</p></div>
<div class="paragraph"><p>Sources of this demo can be found on <a href="https://github.com/Kakadu/lablqt/tree/gh-pages/demos/0.3/demo2">github</a>. Final window should be similar to the one on this picture:</p></div>
<div class="imageblock">
<div class="content">
<img class="img-responsive" src="images/tutorial2/img2.png" alt="images/tutorial2/img2.png">
</div>
</div>
    </div>
</section>
<section>
    <div class="clearfix">
      <div class="page-header" id="signals">
        <h1>Adding signals</h1>
      </div>
<div class="paragraph"><p>When a property is declared a signal is automatically created. Signals can be declared separately using the same PPX syntax extension.</p></div>
<div class="listingblock">
<div class="content"><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">open</span> <span style="color: #bb0066; font-weight: bold">QmlContext</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #008800; font-weight: bold">virtual</span> controller = <span style="color: #008800; font-weight: bold">object</span>(self)
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> hiGotten: message:<span style="color: #888888; font-weight: bold">string</span> -&gt; <span style="color: #888888; font-weight: bold">unit</span>[@@qtsignal]
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> onMouseClicked: <span style="color: #888888; font-weight: bold">unit</span> -&gt; <span style="color: #888888; font-weight: bold">unit</span>[@@qtmeth]
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> clicksCount: <span style="color: #888888; font-weight: bold">int</span>[@@qtprop]

<span style="color: #008800; font-weight: bold">end</span>[@@qtclass]
</pre></div>
</td></tr></table></div></div>
<div class="paragraph"><p>Now signal <code>hiGotten</code> can be connnected to a handler in QtQuick:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">...
Connections {
    <span style="color: #008800; font-weight: bold">target:</span> controller
    <span style="color: #008800; font-weight: bold">onHiGotten:</span> console.log(message)
}
...
</pre></div></div></div>
<div class="paragraph"><p>The <code>on</code> prefix is a syntax convention to declare signal handlers (behind the scene they are slots which were mentioned above). Arguments of the signal (the <code>message</code> in our example) are made available in the context by QtQuick engine. I.e. Qt infers these names from signal&#8217;s declaration. If a signal is declared in the OCaml side without labels Qt will not be able to get the  signal argument names. That&#8217;s why signals should be declared using labeled arguments.</p></div>
<div class="paragraph"><p>Syntax extension is expanded into method <code>emit_$(SIGNAL_NAME)</code> which can be used in main OCaml file.</p></div>
<div class="listingblock">
<div class="content"><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">open</span> <span style="color: #bb0066; font-weight: bold">QmlContext</span>

<span style="color: #008800; font-weight: bold">let</span> main <span style="color: #003388">()</span> =
  <span style="color: #008800; font-weight: bold">let</span> controller_cppobj = <span style="color: #bb0066; font-weight: bold">Controller</span>.create_controller <span style="color: #003388">()</span> <span style="color: #008800; font-weight: bold">in</span>
  <span style="color: #008800; font-weight: bold">let</span> controller = <span style="color: #008800; font-weight: bold">object</span>(self)
    <span style="color: #008800; font-weight: bold">inherit</span> <span style="color: #bb0066; font-weight: bold">Controller</span>.controller controller_cppobj <span style="color: #008800; font-weight: bold">as</span> super

    <span style="color: #008800; font-weight: bold">val</span> <span style="color: #008800; font-weight: bold">mutable</span> counter = <span style="color: #0000DD; font-weight: bold">0</span>
    <span style="color: #008800; font-weight: bold">method</span> getclicksCount <span style="color: #003388">()</span> = counter

    <span style="color: #008800; font-weight: bold">method</span> onMouseClicked <span style="color: #003388">()</span> =
      counter &lt;- counter+<span style="color: #0000DD; font-weight: bold">1</span>;
      self#emit_clicksCountChanged counter;
      <span style="color: #888888">(* Send signal with a new message *)</span>
      self#emit_hiGotten (<span style="color: #bb0066; font-weight: bold">Printf</span>.sprintf <span style="color: #dd2200; background-color: #fff0f0">&quot;Hi %d times&quot;</span> counter);
  <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">in</span>

  set_context_property ~ctx:(get_view_exn ~name:<span style="color: #dd2200; background-color: #fff0f0">&quot;rootContext&quot;</span>) ~name:<span style="color: #dd2200; background-color: #fff0f0">&quot;controller&quot;</span> controller#handler

<span style="color: #008800; font-weight: bold">let</span> <span style="color: #003388">()</span> =
  run_with_QQmlApplicationEngine <span style="color: #bb0066; font-weight: bold">Sys</span>.argv main <span style="color: #dd2200; background-color: #fff0f0">&quot;Root.qml&quot;</span>
</pre></div>
</td></tr></table></div></div>
<div class="paragraph"><p>Full code of this demo is available on <a href="https://github.com/Kakadu/lablqt/tree/gh-pages/demos/0.3/demo3">github</a>.</p></div>
    </div>
</section>
<section>
    <div class="clearfix">
      <div class="page-header" id="types">
        <h1>Supported types</h1>
      </div>
<div class="paragraph"><p>QML has its own type system. It is not as strong or static as the OCaml one but <a href="https://qt-project.org/doc/qt-5/qtqml-typesystem-basictypes.html">basic types</a> exist. When values are passed from C++ to QML they are wrapped into <a href="https://qt-project.org/doc/qt-5/qvariant.html">QVariant</a>, which is a universal container (or <a href="https://blogs.janestreet.com/rethinking-univ/">universal type</a>).
For simple types QML basic types suit well enough. But for more elaborated types (like structures with a number of fields inside) then the right approach is to create a QObject-derived class and put these field inside.
At the moment objects support in <code>lablqt</code> is a little bit awkward but an application like <a href="https://github.com/Kakadu/QOcamlBrowser_quick/">QOcamlBrowser</a> (screenshot below) can be created without this feature. If you have a better way to implement it, I would be glad to hear it.</p></div>
<div class="imageblock">
<div class="content">
<img class="img-responsive" src="images/tutorial2/img3.png" alt="images/tutorial2/img3.png">
</div>
</div>
<div class="paragraph"><p>The demo can be found <a href="http://github.com/Kakadu/lablqt/tree/gh-pages/demos/0.3/demo4">there</a>. In <code>controller.ml</code> some methods and properties, which use the universal type <code>Variant.t</code>, are declared.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">open</span> <span style="color: #bb0066; font-weight: bold">QmlContext</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #008800; font-weight: bold">virtual</span> controller = <span style="color: #008800; font-weight: bold">object</span>(self)
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> getobj: <span style="color: #888888; font-weight: bold">unit</span> -&gt; <span style="color: #bb0066; font-weight: bold">QVariant</span>.t[@@qtmeth]
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> setobj: <span style="color: #bb0066; font-weight: bold">QVariant</span>.t -&gt; <span style="color: #888888; font-weight: bold">unit</span>[@@qtmeth]

  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> person: <span style="color: #bb0066; font-weight: bold">QVariant</span>.t[@@qtprop]

<span style="color: #008800; font-weight: bold">end</span>[@@qtclass]
</pre></div></div></div>
<div class="paragraph"><p>We also need to create a class for the object that will be manipulated by these methods.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">open</span> <span style="color: #bb0066; font-weight: bold">QmlContext</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #008800; font-weight: bold">virtual</span> item = <span style="color: #008800; font-weight: bold">object</span>(self)
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> name: <span style="color: #888888; font-weight: bold">string</span>[@@qtprop]
  <span style="color: #008800; font-weight: bold">method</span> <span style="color: #008800; font-weight: bold">virtual</span> age : <span style="color: #888888; font-weight: bold">int</span>[@@qtprop]
<span style="color: #008800; font-weight: bold">end</span>[@@qtclass]
</pre></div></div></div>
<div class="paragraph"><p>The methods and properties (declared with attributes) of the <code>controller</code> will be used in the main QML file when the construction of root object is completed (in <code>Component.completed</code> signal handler).</p></div>
<div class="listingblock">
<div class="content"><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> QtQuick <span style="color: #0000DD; font-weight: bold">2.0</span>
<span style="color: #008800; font-weight: bold">import</span> QtQuick.Controls <span style="color: #0000DD; font-weight: bold">1.0</span>

ApplicationWindow {
    <span style="color: #008800; font-weight: bold">Component.onCompleted:</span> {
      <span style="color: #888888">// get object from OCaml as method&#39;s result</span>
      <span style="color: #008800; font-weight: bold">var</span> o = controller.getobj();
      console.log(o);
      <span style="color: #888888">// use some methods</span>
      console.log(o.getname());
      console.log(o.getage() );

      <span style="color: #888888">// We pass three values to OCaml side</span>
      <span style="color: #888888">// N.B. method is the same</span>
      controller.setobj(o);
      controller.setobj(<span style="color: #dd2200; background-color: #fff0f0">&quot;asdf&quot;</span>);
      controller.setobj(<span style="color: #0000DD; font-weight: bold">15</span>);

      <span style="color: #888888">// get object from OCaml as property&#39;s value</span>
      <span style="color: #888888">// to get a property&#39;s value we don&#39;t need paretheses at the end</span>
      <span style="color: #008800; font-weight: bold">var</span> p = controller.person;
      console.log(p);
      console.log(p.getname())
      console.log(p.getage());
    }
}
</pre></div>
</td></tr></table></div></div>
<div class="paragraph"><p>In the OCaml side, the value of universal variant is matched and a specific string is printed. The constructor <code>`qobject</code> contains a value of type <code>cppobj</code> which is a raw pointer to an instance of a C++ <code>QObject</code> class. That&#8217;s why an OCaml object is constructed from this value in the first clause.</p></div>
<div class="listingblock">
<div class="content"><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008800; font-weight: bold">class</span> myitem cppObj = <span style="color: #008800; font-weight: bold">object</span>(self)
  <span style="color: #008800; font-weight: bold">inherit</span> <span style="color: #bb0066; font-weight: bold">Item</span>.item cppObj <span style="color: #008800; font-weight: bold">as</span> super
  <span style="color: #008800; font-weight: bold">method</span> getname <span style="color: #003388">()</span> = <span style="color: #dd2200; background-color: #fff0f0">&quot;Vasya&quot;</span>
  <span style="color: #008800; font-weight: bold">method</span> getage <span style="color: #003388">()</span> = <span style="color: #0000DD; font-weight: bold">11</span>
<span style="color: #008800; font-weight: bold">end</span>

...

    <span style="color: #008800; font-weight: bold">method</span> setobj  = <span style="color: #008800; font-weight: bold">function</span>
      | `qobject o -&gt;
         <span style="color: #008800; font-weight: bold">let</span> item = <span style="color: #008800; font-weight: bold">new</span> myitem o <span style="color: #008800; font-weight: bold">in</span>
         printf <span style="color: #dd2200; background-color: #fff0f0">&quot;qobject: %s %d</span><span style="color: #0044dd; background-color: #fff0f0">\n</span><span style="color: #dd2200; background-color: #fff0f0">%!&quot;</span> (item#getname <span style="color: #003388">()</span>) (item#getage<span style="color: #003388">()</span>)
      | `<span style="color: #888888; font-weight: bold">string</span> s -&gt; printf <span style="color: #dd2200; background-color: #fff0f0">&quot;String: &#39;%s&#39;</span><span style="color: #0044dd; background-color: #fff0f0">\n</span><span style="color: #dd2200; background-color: #fff0f0">%!&quot;</span> s
      | `<span style="color: #888888; font-weight: bold">int</span>  x -&gt; printf <span style="color: #dd2200; background-color: #fff0f0">&quot;int %d</span><span style="color: #0044dd; background-color: #fff0f0">\n</span><span style="color: #dd2200; background-color: #fff0f0">%!&quot;</span> x
      | `empty -&gt; print_endline <span style="color: #dd2200; background-color: #fff0f0">&quot;empty&quot;</span>
...
</pre></div>
</td></tr></table></div></div>
<div class="paragraph"><p>To avoid pattern matching we can allow the use of a specific type in properties and methods which will represent a raw C++ pointer to QObject. It&#8217;s not obvious at the moment how good it will be because the current approach is more powerful but more verbose. If you have any ideas on this topic I will be glad to <a href="mailto:kakadu.hafanana@gmail.com">read</a> e-mails from you.</p></div>
<div class="paragraph"><p>At the moment not many types can be used in methods' signatures but any complex type can be implemented using <code>variant</code> type. It should not be a problem to support <a href="https://qt-project.org/doc/qt-5/qtqml-typesystem-basictypes.html">QML basic types</a> in syntax extension if needed.</p></div>
    </div>
</section>
<section>
    <div class="clearfix">
      <div class="page-header" id="building">
        <h1>Compiling applications using lablqt</h1>
      </div>
<div class="paragraph"><p>OCaml+QtQuick applications can start up both from C++ and OCaml. Examples using makefiles are available in links above and at lablqt&#8217;s <a href="http://github.com/Kakadu/lablqt/tree/master/qml">repository</a>. Also <a href="http://github.com/Kakadu/QOcamlBrowser_quick">QOCamlBrowser</a> is available, it uses ocamlbuild as the build system.</p></div>
<div class="paragraph"><p>To compile sources manually we need to exectute following commands. Let&#8217;s suppose that PPX syntax extension was used at files <code>module1.ml</code> and <code>module2.ml</code>. To compile them we need to execute:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>ocamlopt -I `ocamlfind query lablqml` -c -ppx "ppx_qt -destdir . -ext cpp" module1.ml
ocamlopt -I `ocamlfind query lablqml` -c -ppx "ppx_qt -destdir . -ext cpp" module2.ml</pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s suppose that files <code>module1.ml</code> and <code>module2.ml</code> declare classes called <code>class1</code> and <code>class2</code> respectively. After executing of two commands above four files should be created: <code>class1.h</code>, <code>class1_c.cpp</code>, <code>class2.h</code> and <code>class2_c.cpp</code>. These C++ files should be compiled as they are:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>g++ `pkg-config --cflags Qt5Quick` -fPIC -c class2_c.cpp -o class2_c.o
g++ `pkg-config --cflags Qt5Quick` -fPIC -c class1_c.cpp -o class1_c.o</pre>
</div></div>
<div class="paragraph"><p>Header files contain meta-information about types. So, we need to apply Qt Metaobject compiler and compile generated C++ files:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>moc class1.h -o moc_class1.cpp
g++ `pkg-config --cflags Qt5Quick` -fPIC -c moc_class1.cpp -o moc_class1.o
moc class2.h -o moc_class2.cpp
g++ `pkg-config --cflags Qt5Quick` -fPIC -c moc_class2.cpp -o moc_class2.o</pre>
</div></div>
<div class="paragraph"><p>Also we need main <code>.ml</code> file which uses classes <code>Module1.class1</code> and <code>Module2.class2</code>:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>ocamlfind opt -package lablqml -c program.ml</pre>
</div></div>
<div class="paragraph"><p>And now we can link everything into final executable:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>ocamlfind opt -package lablqml -linkpkg \
  -cclib -lstdc++ -ccopt -L`qmake -query QT_INSTALL_LIBS` \
  -cclib -lQt5Quick -cclib -lQt5Qml -cclib -lQt5Network \
  -cclib -lQt5Widgets -cclib -lQt5Gui -cclib -lQt5Core \
  module1.cmx module1.cmx program.cmx \
  class2_c.o class2_c.o moc_class1.o moc_class2.o \
  -o a.out</pre>
</div></div>
    </div>
</section>
<section>
    <div class="clearfix">
      <div class="page-header" id="conclusion">
        <h1>Conclusion</h1>
      </div>
<div class="paragraph"><p>There are many aspects of QtQuick which are not mentioned in this tutorial. For example, in the 
<a href="tutorial.html">previous tutorial</a> you can read about classes for desktop applications which live in harmony with your platform&#8217;s style. There is Model-View framework available both in Qt and <code>lablqt</code> which is used rather much in QOcamlBrowser. QtQuick has an embedded ECMAScript engine in it and you can compile OCaml code using <code>js_of_ocaml</code> and run it as a crossplatform application.
QtQuick renders itself with OpenGL, so <a href="http://qmlbook.org/ch08/index.html">particle simulations</a> and <a href="http://qmlbook.org/ch09/index.html">shader effects</a> are built in.</p></div>
<div class="paragraph"><p>In my experience I <strong>should</strong> say that <code>lablqt</code> is mature enough for big industrial applications to get some feedback. I hope that after reading this tutorial somebody will try it and send me some notes about the experience.</p></div>
    </div>
</section>
<section>
    <div class="clearfix">
      <div class="page-header" id="qt5">
        <h1>P.S. Getting and installing Qt5</h1>
      </div>
<div class="clearfix">
<h2 id="using_package_repository">Using package repository</h2>
<div class="paragraph"><p>There is Qt 5.2.1 in Ubuntu Trusty and Qt5.3 in current Debian/testing (July 1, 2014). I have got Qt 5.3 using official installer but all code should work with Qt 5.2 too. If it doesn&#8217;t, please report me somehow.</p></div>
</div>
<div class="clearfix">
<h2 id="official_packages">Official packages</h2>
<div class="paragraph"><p>are available on <a href="https://download.qt-project.org/official_releases/qt/5.3/5.3.0/">Qt Project</a>.</p></div>
</div>
<div class="clearfix">
<h2 id="building_from_git">Building from Git</h2>
<div class="paragraph"><p>Official Qt Project wiki is
<a href="http://qt-project.org/wiki/Building_Qt_5_from_Git">there</a>. Below you
can see <code>my-init</code> and <code>configure</code> scripts which configure
Qt5 to build only modules needed by lablqt.</p></div>
<div class="listingblock">
<div class="title">My init-repository script</div>
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #888888">#!/usr/bin/env bash</span>
<span style="color: #336699">MODULES</span>=qtbase,qtdeclarative,qtjsbackend,qtactiveqt,qtquickcontrols
perl ./init-repository --module-subset=<span style="color: #336699">$MODULES</span> -f <span style="color: #336699">$@</span>
</pre></div></div></div>
<div class="listingblock">
<div class="title">My configure script</div>
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #888888">#!/bin/bin/env bash</span>
<span style="color: #003388">set</span> -x
./configure -developer-build -opensource -nomake examples -nomake tests -confirm-license <span style="color: #0044dd; background-color: #fff0f0">\</span>
  -no-gtkstyle -no-glib -no-cups  <span style="color: #336699">$@</span>
</pre></div></div></div>
<div class="paragraph"><p>Qt compiles some code during <code>./configure</code> stage, don&#8217;t worry, it&#8217;s
normal.</p></div>
<div class="paragraph"><p>Compilation time depends on your machine. Some fellas have finished with <code>-j8</code> in 5 minutes. On my Intel Core i3 I can do it with <code>-j2</code> in 30 minutes.</p></div>
<div class="paragraph"><div class="title">P.S.</div><p>I have discovered some issues with compilation my QOCamlBrowser app recently on Ubuntu 13.10 32bit on Intel Core 2 Duo CPU. My application was crashing in <code>qt_memfill32_sse2 (dest=0x8910e10, value=0, count=194)</code> at <code>painting/qdrawhelper_sse2.cpp:264</code>. So, I have decided to disable special instruction sets for Qt5 on this machine by improving <code>./my-configure</code> script. I put this stuff in <code>P.S.</code> section because I haven&#8217;t tested it on my Intel i3 machine.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #888888">#!/usr/bin/env bash</span>
<span style="color: #003388">set</span> -x
<span style="color: #336699">NOFB</span>=<span style="color: #dd2200; background-color: #fff0f0">&quot;-no-directfb -no-linuxfb -no-eglfs -no-kms&quot;</span>
<span style="color: #336699">SQL</span>=<span style="color: #dd2200; background-color: #fff0f0">&quot;-no-sql-mysql -no-sql-sqlite&quot;</span>
<span style="color: #336699">NOSSE</span>=<span style="color: #dd2200; background-color: #fff0f0">&quot;-no-sse2 -no-sse3 -no-ssse3 -no-sse4.1 -no-sse4.2 -no-avx -no-avx2&quot;</span>
./configure -developer-build -opensource -nomake examples -nomake tests -confirm-license <span style="color: #0044dd; background-color: #fff0f0">\</span>
  -no-gtkstyle -no-glib -no-cups -no-nis <span style="color: #0044dd; background-color: #fff0f0">\</span>
  <span style="color: #336699">$SQL</span> <span style="color: #336699">$NOFB</span> <span style="color: #336699">$NOSSE</span> <span style="color: #0044dd; background-color: #fff0f0">\</span>
  <span style="color: #336699">$@</span>
</pre></div></div></div>
<div class="paragraph"><p>Value <code>$NOFB</code> disables framebuffer and KMS support. I think these low-level interfaces are not needed for our OCaml GUI projects. Also we disable SQLite and MySQL DBMS in Qt. Value <code>$NOSSE</code> disables all special instruction sets.With that <code>./my-configure</code> QtQuick examples in Qt still work and my QOcamlBrowser startups without crash.</p></div>
<div class="paragraph"><p>If you want to compile Qt faster you can study next options of <code>./configure script</code>:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>    -no-feature-&lt;feature&gt; Do not compile in &lt;feature&gt;.
    -feature-&lt;feature&gt; .. Compile in &lt;feature&gt;. The available features
                          are described in src/corelib/global/qfeatures.txt</pre>
</div></div>
<div class="paragraph"><div class="title">P.P.S. MacOS remark</div><p>There are some issues <a href="https://bugreports.qt-project.org/browse/QTBUG-35256">on Qt bugtracker</a> about using <code>pkg-config</code> on MacOS. It seems that they handle <code>-F</code> option wrong. The solution is mentioned <a href="https://github.com/Kakadu/lablqt/issues/17">here</a>.</p></div>
<div class="paragraph"><p>If you should compile Qt from source you will be able to avoid this issue by passing special options to <code>./configure</code> script: <code>-prefix /opt/Qt/5.2.1 -opensource -nomake tests -no-xcb -no-framework</code>.</p></div>
<div class="paragraph"><div class="title">P.P.P.S.</div><p>Next script will be useful (as a part of <code>~/.bashrc</code>) for setting local environment for your Qt5 build:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">with_qt5() {
  <span style="color: #003388">export </span><span style="color: #336699">PATH</span>=~/mand/prog/qt/qt5/qtbase/bin:<span style="color: #336699">$PATH</span>  <span style="color: #888888"># where Qt5 has been build</span>
  qmake -query QT_VERSION
  <span style="color: #003388">export </span><span style="color: #336699">LD_LIBRARY_PATH</span>=<span style="color: #dd2200; background-color: #fff0f0">`</span>qmake -query QT_INSTALL_LIBS<span style="color: #dd2200; background-color: #fff0f0">`</span>:<span style="color: #336699">$LD_LIBRARY_PATH</span>
  <span style="color: #003388">export </span><span style="color: #336699">PKG_CONFIG_PATH</span>=<span style="color: #dd2200; background-color: #fff0f0">`</span>qmake -query QT_INSTALL_LIBS<span style="color: #dd2200; background-color: #fff0f0">`</span>/pkgconfig:<span style="color: #336699">$PKG_CONFIG_PATH</span>
}
</pre></div></div></div>
</div>
    </div>
</section>
        </div>  <!-- /.col-md-12 -->
    </div>  <!-- /.row -->

  </div>  <!-- /.container -->

<div class="container">
    <footer id="footer" role="contentinfo">
        <div class="container">
<div class="row"><div id="footnotes"></div></div>
<div id="footer-text">
Last updated 2014-07-24 00:26:37 MSK
<br>Built with <a href="https://github.com/llaville/asciidoc-bootstrap-backend">AsciiDoc-Bootstrap backend</a> 4.0.0
</div>
        </div>
    </footer>
</div>

    <script src="./javascripts/jquery.min.js"></script>
    <script src="./bootstrap/js/bootstrap.min.js"></script>
    <script src="./javascripts/asciidoc.js"></script>
    <!-- Install TOC and/or footnotes (if necessary) -->
    <script type="text/javascript">asciidoc.install(2);</script>

    <script src="./javascripts/jquery.ui.totop.min.js"></script>

    <!-- Remove footnotes if empty block -->
    <script type="text/javascript">$(function(){ if ($("#footnotes").length == 0) $("#footnotes").remove(); });</script>

    <script type="text/javascript">$(function(){ if ($("#dropdown-menu-versions")) $("#dropdown-menu-versions").parent().parent().remove(); });</script>

    <script type="text/javascript">$(function(){ $().UItoTop(); });</script>

  </body>
</html>
